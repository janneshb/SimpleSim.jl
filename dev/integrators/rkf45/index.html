<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Runge-Kutta-Fehlberg · SimpleSim.jl</title><meta name="title" content="Runge-Kutta-Fehlberg · SimpleSim.jl"/><meta property="og:title" content="Runge-Kutta-Fehlberg · SimpleSim.jl"/><meta property="twitter:title" content="Runge-Kutta-Fehlberg · SimpleSim.jl"/><meta name="description" content="Documentation for SimpleSim.jl."/><meta property="og:description" content="Documentation for SimpleSim.jl."/><meta property="twitter:description" content="Documentation for SimpleSim.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/custom.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img class="docs-light-only" src="../../assets/logo.gif" alt="SimpleSim.jl logo"/><img class="docs-dark-only" src="../../assets/logo-dark.gif" alt="SimpleSim.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SimpleSim.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><a class="tocitem" href="../../manual/api/">API</a></li><li><span class="tocitem">Manual</span><ul><li><span class="tocitem">Setting up Models</span><ul><li><a class="tocitem" href="../../manual/ct_sims/">Continuous-Time Models</a></li><li><a class="tocitem" href="../../manual/dt_sims/">Discrete-Time &amp; Hybrid Models</a></li><li><a class="tocitem" href="../../manual/nested_sims/">Nested Models</a></li><li><a class="tocitem" href="../../manual/zero_crossing/">Zero-Crossing Detection</a></li><li><a class="tocitem" href="../../manual/random_vars/">Random Variables</a></li></ul></li><li><a class="tocitem" href="../../manual/run_sims/">Running Simulations</a></li><li><span class="tocitem">Supported Integrators</span><ul><li><a class="tocitem" href="../overview/">Overview</a></li><li><a class="tocitem" href="../euler/">Euler</a></li><li><a class="tocitem" href="../heun/">Heun</a></li><li><a class="tocitem" href="../rk4/">4th Order Runge-Kutta</a></li><li class="is-active"><a class="tocitem" href>Runge-Kutta-Fehlberg</a><ul class="internal"><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Mathematical-Background"><span>Mathematical Background</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../manual/output/">Interpreting Output</a></li><li><a class="tocitem" href="../../manual/misc/">Miscellaneous</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/minimal_example/">Minimal Example</a></li><li><a class="tocitem" href="../../examples/bouncing_ball/">Bouncing Ball</a></li><li><a class="tocitem" href="../../examples/feedback_control/">Feedback Control</a></li><li><a class="tocitem" href="../../examples/random_walk/">Random Walk</a></li><li><a class="tocitem" href="../../examples/four_rotor_drone/">Four-Rotor Drone</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Supported Integrators</a></li><li class="is-active"><a href>Runge-Kutta-Fehlberg</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Runge-Kutta-Fehlberg</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/janneshb/SimpleSim.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/janneshb/SimpleSim.jl/blob/main/docs/src/integrators/rkf45.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Runge-Kutta-Fehlberg-Method-/-RKF45"><a class="docs-heading-anchor" href="#Runge-Kutta-Fehlberg-Method-/-RKF45">Runge-Kutta-Fehlberg Method / <code>RKF45</code></a><a id="Runge-Kutta-Fehlberg-Method-/-RKF45-1"></a><a class="docs-heading-anchor-permalink" href="#Runge-Kutta-Fehlberg-Method-/-RKF45" title="Permalink"></a></h1><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><p>The desired integration method used for continuous-time dynamics is passed to the <code>simulate</code> function as a keyword argument.</p><pre><code class="language-julia hljs">using SimpleSim

# my_model = ...

out = simulate(my_model, T = T_end, integrator = RKF45)</code></pre><h2 id="Mathematical-Background"><a class="docs-heading-anchor" href="#Mathematical-Background">Mathematical Background</a><a id="Mathematical-Background-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Background" title="Permalink"></a></h2><p>The Runge-Kutta-Fehlberg method, also known as Fehlberg&#39;s method or simply RKF45, is an adaptive step size solver for ordinary differential equations. The core idea of the method is to adjust the current step size by looking at the difference between the estimates using the 4th and 5th order Runge-Kutta methods.</p><p>First, the 4th and 5th order Runge-Kutta estimates are computed. We denote these as <span>$x^+_\text{RK4}$</span> and <span>$x^+_\text{RK5}$</span>, respectively. Given the coefficients <span>$k_1$</span> through <span>$k_6$</span>, the two estimates can be computed as follows.</p><p class="math-container">\[x^+_\text{RK4} = x + \Delta t(\frac{25}{216} k_1 + \frac{1408}{2565}k_3 + \frac{2197}{4101}k_4 - \frac{1}{5}k_5)\]</p><p class="math-container">\[x^+_\text{RK5} = x + \Delta t(\frac{16}{135} k_1 + \frac{6656}{12825}k_3 + \frac{28561}{56430}k_4 - \frac{9}{50}k_5 + \frac{2}{55}k_6)\]</p><p>Where the coefficients <span>$k_i$</span> are computed as</p><p class="math-container">\[k_1 = f(x, u(t), p, t)\]</p><p class="math-container">\[k_2 = f(x + \frac{\Delta t}{4} k_1, u(t + \frac{\Delta t}{4}), p, t + \frac{\Delta t}{4})\]</p><p class="math-container">\[k_3 = f(x + \frac{3\Delta t}{32} k_1 + \frac{9\Delta t}{32}k_2, u(t + \frac{3\Delta t}{8}), p, t + \frac{3\Delta t}{8})\]</p><p class="math-container">\[k_4 = f(x + \frac{1932\Delta t}{2197}k_1 - \frac{7200\Delta t}{2197}k_2 + \frac{7296\Delta t}{2197} k_3, u(t + \frac{12\Delta t}{13}), p, t+ \frac{12\Delta t}{13})\]</p><p class="math-container">\[k_5 = f(x + \frac{439\Delta t}{216}k_1 - 8\Delta t k_2 + \frac{3680\Delta t}{513}k_3 - \frac{845 \Delta t}{4104}k_4, u(t + \Delta t), p, t + \Delta t)\]</p><p class="math-container">\[k_6 = f(x - \frac{8\Delta t}{27} k_1 + 2\Delta tk_2 - \frac{3544\Delta t}{2565} + \frac{1859\Delta t}{4104}k_4 - \frac{11\Delta t}{40}k_5, u(t + \frac{\Delta t}{2}), p, t + \frac{\Delta t}{2})\]</p><p>After computing both estimates, the optimal adaptive step size <span>$\Delta t_\text{opt}$</span> can be computed using the following formula,</p><p class="math-container">\[\Delta t_\text{opt} = \Delta t\cdot \bigg(\frac{\varepsilon}{2\lvert x^+_\text{RK4} - x^+_\text{RK5} \rvert}\bigg)^{0.25},\]</p><p>where <span>$\varepsilon$</span> denotes a desired tolerance.</p><p><code>SimpleSim.jl</code> uses the following approximation</p><p class="math-container">\[\Delta t_\text{opt} = 0.84\cdot \bigg(\frac{\varepsilon_\text{abs}}{\lVert x^+_\text{RK4} - x^+_\text{RK5} \rVert_\infty}\bigg)^{0.25},\]</p><p>where the absolute tolerance is computed as</p><p class="math-container">\[\varepsilon_\text{abs} = \varepsilon_\text{rel}\cdot \lVert x^+_\text{RK5}\rVert_2\]</p><p>and the relative tolerance is a constant simulation option called <code>RKF45_REL_TOL</code>.</p><p>You can read more about this on <a href="https://en.wikipedia.org/wiki/Runge–Kutta–Fehlberg_method">Wikipedia</a>, on <a href="https://ece.uwaterloo.ca/~dwharder/NumericalAnalysis/14IVPs/rkf45/complete.html">this great website</a> by the University of Waterloo or in <a href="https://maths.cnam.fr/IMG/pdf/RungeKuttaFehlbergProof.pdf">this very helpful excerpt</a> from a text book on numerical methods by John Mathews and Kurtis Fink.</p><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><p>For obivious reasons, Runge-Kutta-Fehlberg is the slowest method supported by <code>SimpleSim.jl</code>. The system dynamics function is called at least six times and for stiff problems the adaptive step size can get very small causing the simulation to become very slow.</p><p>However, for certain classes of problems, adaptive step size methods are absolutely necessary. Especially system&#39;s with sensitive dependence on initial conditions, i. e. chaotic systems, can be solved much faster and with higher precision using adaptive step size methods. The only alternative would be using a fixed step size method with a very small step size. This, however, would be computationally more expensive in a lot of cases.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../rk4/">« 4th Order Runge-Kutta</a><a class="docs-footer-nextpage" href="../../manual/output/">Interpreting Output »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Thursday 3 October 2024 14:07">Thursday 3 October 2024</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
